!function(e){"use strict";function t(t,s){this.options=s,this.$input=e(t);var i=this;i.classes={list:"light-autocomplete-list",element:"light-autocomplete-element",container:"light-autocomplete-container"},i.selectors={list:".light-autocomplete-list ul",element:"."+i.classes.element,container:"."+i.classes.container},i.id="",i.search="",i.last=0,i.firstItem=1,i.data=[],i.defaults={minChars:1,heightOfElement:50,visibleElementInList:5,minSize:6,onClick:function(e){i.setItem(e)},onPressEnter:function(e){i.setItem(e)},onPressTabEsc:function(e){i.setItem(e)}},i.init()}var s={ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ESC:27};e.LightAutocomplete=t,t.prototype={init:function(){var t=this;t.defaults=e.extend({},t.defaults,t.options),t.defaults.maxHeight=t.defaults.heightOfElement*t.defaults.visibleElementInList,t.createInputID(),t.setAutocompleteBrowserOff(),t.createContainer(),t.insertTemplate(),t.setKeyDown(),t.setKeyUp(),t.setPressEnterKey(),t.setFocus()},createInputID:function(){var e=this;void 0!==e.$input.attr("id")&&null!==e.$input.attr("id")?e.id="#"+e.$input.attr("id"):(e.id="light-autocomplete-"+Math.ceil(1e6*Math.random()),e.$input.attr("id",e.id),e.id="#"+e.id)},setElementMouseover:function(){var t=this;e(t.selectors.element).on("mouseover.lightAutocomplete touchstart.lightAutocomplete",function(s){return s.preventDefault(),e(t.selectors.element).removeClass("selected"),e(this).addClass("selected"),!1})},setKeyDown:function(){var e=this;e.$input.on("keydown.lightAutocomplete",function(t){if(t.keyCode==s.UP||t.keyCode==s.DOWN)return t.preventDefault(),!1;switch(t.keyCode){case s.ESC:t.preventDefault();case s.TAB:e.ifNotMatchData();var i=e.data[0];e.defaults.onPressTabEsc(i),e.resetDropDown()}t.stopImmediatePropagation()})},setKeyUp:function(){var e=this;e.$input.on("keyup.lightAutocomplete",function(t){if(e.isMoveArrow(t))return!1;e.showTemplate(),e.search=e.$input.val().toLowerCase(),e.search.length>=e.defaults.minChars&&e.defaults.sourceData(e.search,function(t){t.lenght>0&&(e.data=[]),e.createDropDown(t)})})},isMoveArrow:function(t){var i=this;switch(t.keyCode){case s.ESC:case s.TAB:case s.ENTER:case s.LEFT:case s.RIGHT:return t.preventDefault(),!0;case s.UP:t.preventDefault();n=parseInt(e(i.selectors.element+".selected").attr("item"));return e(i.selectors.element).removeClass("selected"),n>1?e(i.selectors.element+'[item="'+(n-1)+'"]').addClass("selected"):e(i.selectors.element+'[item="1"]').addClass("selected"),n==i.firstItem&&1!=n&&(e(i.selectors.list,i.selectors.container).animate({scrollTop:"-="+i.defaults.heightOfElement},50),i.firstItem--),!0;case s.DOWN:t.preventDefault();var n=parseInt(e(i.selectors.element+".selected").attr("item"));return e(i.selectors.element).removeClass("selected"),n<i.last?e(i.selectors.element+'[item="'+(n+1)+'"]').addClass("selected"):e(i.selectors.element+'[item="'+i.last+'"]').addClass("selected"),n==i.firstItem+i.defaults.visibleElementInList-1&&n!=i.last&&(e(i.selectors.list,i.selectors.container).animate({scrollTop:"+="+i.defaults.heightOfElement},50),i.firstItem++),!0;default:i.firstItem=1}},createDropDown:function(t){var s=this,i=0;t.forEach(function(t,n){if(!1!==s.defaults.minSize&&i>=s.defaults.minSize)return!1;t.label.toLowerCase().indexOf(s.search)>-1&&(s.data[i]=t,s.last=++i,e(s.selectors.list,s.selectors.container,s.$input.parent()).append(s.createTempleteItem(t,i)))}),s.setClick(),s.setElementMouseover()},setFocus:function(){var t=this;e(document).on("click",function(s){var i=e(t.selectors.container);i.is(s.target)||t.$input.is(s.target)?t.$input.is(s.target)&&e(t.selectors.list,i).show():e(t.selectors.list,i).hide()})},setItem:function(e){var t=this;void 0!==e&&t.$input.val(e.label)},setPressEnterKey:function(){var t=this;t.$input.keypress(function(i){switch(i.which){case s.ENTER:t.ifNotMatchData(),t.search.length<t.defaults.minChars&&(t.data=[]);var n=parseInt(e(t.selectors.element+".selected").attr("item"))-1,a=t.data[n];t.defaults.onPressEnter(a),t.resetDropDown(),i.preventDefault()}})},setClick:function(){var t=this;e(t.selectors.element).on("click.lightAutocomplete tap.lightAutocomplete",function(){t.ifNotMatchData();var s=parseInt(e(this).attr("item"))-1,i=t.data[s];t.defaults.onClick(i),t.resetDropDown()})},resetDropDown:function(){var t=this;t.data=[],e(t.selectors.list,t.selectors.container).parent().remove(),t.insertTemplate()},insertTemplate:function(){var t=this;e(t.createTemplateList()).insertAfter(t.id)},ifNotMatchData:function(){var t=this;""==t.$input.val()&&(t.data=[]),e(t.selectors.list+" li",t.selectors.container).length||(t.data=[],t.$input.val(""))},showTemplate:function(){var t=this;e(t.selectors.list,t.selectors.container).parent().show(),e(t.selectors.list,t.selectors.container).html("")},createContainer:function(){var e=this;e.$input.wrap('<div class="'+e.classes.container+'"></div>')},createTemplateList:function(){var e=this;return'<div class="'+e.classes.list+'" style="display:none;"><ul style="overflow-y: scroll; max-height: '+e.defaults.maxHeight+'px;"></ul></div>'},createTempleteItem:function(e,t){var s=this,i="";return 1==t&&(i=" selected"),'<li><div item="'+t+'" class="'+s.classes.element+" "+i+'" style="max-height: '+s.defaults.heightOfElement+'px;">'+e.label+"</div></li>"},setAutocompleteBrowserOff:function(){this.$input.attr("autocomplete","off")}},e.fn.lightAutocomplete=function(s,i){var n="lightAutocomplete";return arguments.length?this.each(function(){var a=e(this),l=a.data(n);"string"==typeof s?l&&"function"==typeof l[s]&&l[s](i):(l&&l.dispose&&l.dispose(),l=new t(this,s),a.data(n,l))}):this.first().data(n)}}(jQuery);