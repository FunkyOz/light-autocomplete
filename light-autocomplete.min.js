!function(e){"use strict";function t(t,s){this.options=s,this.$input=e(t);var a=this;a.classes={list:"light-autocomplete-list",element:"light-autocomplete-element",container:"light-autocomplete-container"},a.selectors={list:".light-autocomplete-list ul",element:"."+a.classes.element,container:"."+a.classes.container},a.id="",a.search="",a.last=0,a.firstItem=1,a.data=[],a.defaults={minChars:1,heightOfElement:50,visibleElementInList:5,minSize:6,onClick:function(e){a.setItem(e)},onPressEnter:function(e){a.setItem(e)},onPressTab:function(e){a.setItem(e)},onPressEsc:function(e){a.setItem(e)}},a.init()}var s={ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ESC:27};e.LightAutocomplete=t,t.prototype={init:function(){var t=this;t.defaults=e.extend({},t.defaults,t.options),t.defaults.maxHeight=t.defaults.heightOfElement*t.defaults.visibleElementInList,void 0!==t.$input.attr("id")&&null!==t.$input.attr("id")?t.id="#"+t.$input.attr("id"):(t.id="light-autocomplete-"+Math.ceil(1e6*Math.random()),t.$input.attr("id",t.id),t.id="#"+t.id),t.$input.attr("autocomplete","off"),t.createContainer(),t.insertTemplate(),t.setKeyDown(),t.setKeyUp(),t.setFocus()},setElementMouseover:function(){var t=this;e(t.selectors.element).on("mouseover.lightAutocomplete touchstart.lightAutocomplete",function(s){return s.preventDefault(),e(t.selectors.element).removeClass("selected"),e(this).addClass("selected"),!1})},setKeyDown:function(){var t=this;t.$input.on("keydown.lightAutocomplete",function(a){switch(a.keyCode){case s.UP:case s.DOWN:return a.preventDefault(),!1;case s.ESC:a.preventDefault(),t.ifNotMatchData();n=t.data[0];t.defaults.onPressEsc(n);break;case s.TAB:a.preventDefault(),t.ifNotMatchData();n=t.data[0];t.defaults.onPressTab(n);break;case s.ENTER:a.preventDefault(),t.ifNotMatchData();var i=parseInt(e(t.selectors.element+".selected").attr("item"))-1,n=t.data[i];t.defaults.onPressEnter(n)}t.resetDropDown(),a.stopImmediatePropagation()})},setKeyUp:function(){var e=this;e.$input.on("keyup.lightAutocomplete",function(t){switch(t.keyCode){case s.ESC:case s.TAB:case s.ENTER:case s.LEFT:case s.RIGHT:return t.preventDefault(),!1;case s.UP:return t.preventDefault(),e.moveUp(),!1;case s.DOWN:return t.preventDefault(),e.moveDown(),!1;default:e.firstItem=1}e.showTemplate(),e.search=e.$input.val().toLowerCase(),e.search.length>=e.defaults.minChars&&e.defaults.sourceData(e.search,function(t){t.lenght>0&&(e.data=[]),e.createDropDown(t)})})},moveDown:function(){var t=this,s=parseInt(e(t.selectors.element+".selected").attr("item"));e(t.selectors.element).removeClass("selected"),s<t.last?e(t.selectors.element+'[item="'+(s+1)+'"]').addClass("selected"):e(t.selectors.element+'[item="'+t.last+'"]').addClass("selected"),s==t.firstItem+t.defaults.visibleElementInList-1&&s!=t.last&&(e(t.selectors.list,t.selectors.container).animate({scrollTop:"+="+t.defaults.heightOfElement},50),t.firstItem++)},moveUp:function(){var t=this,s=parseInt(e(t.selectors.element+".selected").attr("item"));e(t.selectors.element).removeClass("selected"),s>1?e(t.selectors.element+'[item="'+(s-1)+'"]').addClass("selected"):e(t.selectors.element+'[item="1"]').addClass("selected"),s==t.firstItem&&1!=s&&(e(t.selectors.list,t.selectors.container).animate({scrollTop:"-="+t.defaults.heightOfElement},50),t.firstItem--)},createDropDown:function(t){var s=this,a=0;t.forEach(function(t,i){if(!1!==s.defaults.minSize&&a>=s.defaults.minSize)return!1;t.label.toLowerCase().indexOf(s.search)>-1&&(s.data[a]=t,s.last=++a,e(s.selectors.list,s.selectors.container,s.$input.parent()).append(s.createTempleteItem(t,a)))}),s.setClick(),s.setElementMouseover()},setFocus:function(){var t=this;e(document).on("click",function(s){var a=e(t.selectors.container);a.is(s.target)||t.$input.is(s.target)?t.$input.is(s.target)&&e(t.selectors.list,a).show():e(t.selectors.list,a).hide()})},setItem:function(e){var t=this;void 0!==e&&t.$input.val(e.label)},setClick:function(){var t=this;e(t.selectors.element).on("click.lightAutocomplete tap.lightAutocomplete",function(){t.ifNotMatchData();var s=parseInt(e(this).attr("item"))-1,a=t.data[s];t.defaults.onClick(a),t.resetDropDown()})},resetDropDown:function(){var t=this;t.data=[],e(t.selectors.list,t.selectors.container).parent().remove(),t.insertTemplate()},insertTemplate:function(){var t=this;e(t.createTemplateList()).insertAfter(t.id)},ifNotMatchData:function(){var t=this;""==t.$input.val()&&(t.data=[]),e(t.selectors.list+" li",t.selectors.container).length||(t.data=[])},showTemplate:function(){var t=this;e(t.selectors.list,t.selectors.container).parent().show(),e(t.selectors.list,t.selectors.container).html("")},createContainer:function(){var e=this;e.$input.wrap('<div class="'+e.classes.container+'"></div>')},createTemplateList:function(){var e=this;return'<div class="'+e.classes.list+'" style="display:none;"><ul style="overflow-y: scroll; max-height: '+e.defaults.maxHeight+'px;"></ul></div>'},createTempleteItem:function(e,t){var s=this,a="";return 1==t&&(a=" selected"),'<li><div item="'+t+'" class="'+s.classes.element+" "+a+'" style="max-height: '+s.defaults.heightOfElement+'px;">'+e.label+"</div></li>"}},e.fn.lightAutocomplete=function(s,a){var i="lightAutocomplete";return arguments.length?this.each(function(){var n=e(this),l=n.data(i);"string"==typeof s?l&&"function"==typeof l[s]&&l[s](a):(l&&l.dispose&&l.dispose(),l=new t(this,s),n.data(i,l))}):this.first().data(i)}}(jQuery);