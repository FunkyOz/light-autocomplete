!function(e){"use strict";var t=13,s=37,a=38,n=39,l=40,i=9,o=27,r=20,c=16;function u(t,s){this.options=s,this.$input=e(t);var a=this;a.classes={list:"light-autocomplete-list",element:"light-autocomplete-element",container:"light-autocomplete-container"},a.selectors={list:"."+a.classes.list+" ul",element:"."+a.classes.element,container:"."+a.classes.container},a.cache=[],a.id="",a.search="",a.last=0,a.firstItem=1,a.data=[],a.defaults={sendValue:!1,httpMethod:"GET",postData:{},minChars:1,heightOfElement:50,visibleElementInList:5,minSize:6,onClick:function(e){a.setItem(e)},onPressEnter:function(e){a.setItem(e)},onPressTab:function(e){a.setItem(e)},onPressEsc:function(e){a.setItem(e)}},a.init()}e.LightAutocomplete=u,u.prototype={init:function(){var t=this;t.$input.attr("autocomplete","off"),t.defaults=e.extend({},t.defaults,t.options),t.defaults.maxHeight=t.defaults.heightOfElement*t.defaults.visibleElementInList,void 0!==t.$input.attr("id")&&null!==t.$input.attr("id")?t.id="#"+t.$input.attr("id"):(t.id="light-autocomplete-"+Math.ceil(1e6*Math.random()),t.$input.attr("id",t.id),t.id="#"+t.id),t.$input.attr("autocomplete","off"),t.createContainer(),t.insertTemplate(),t.setKeyDown(),t.setKeyUp(),t.setFocus()},setElementMouseover:function(){var t=this;e(t.selectors.element).on("mouseover.lightAutocomplete touchstart.lightAutocomplete",function(s){return s.preventDefault(),e(t.selectors.element).removeClass("selected"),e(this).addClass("selected"),!1})},setKeyDown:function(){var s=this;s.$input.on("keydown.lightAutocomplete",function(n){switch(n.keyCode){case a:case l:case r:case c:return n.preventDefault(),!1;case o:n.preventDefault(),s.ifNotMatchData();var u=s.data[0];s.defaults.onPressEsc(u);break;case i:n.preventDefault(),s.ifNotMatchData();u=s.data[0];s.defaults.onPressTab(u);break;case t:n.preventDefault(),s.ifNotMatchData();var d=parseInt(e(s.selectors.element+".selected").attr("item"))-1;u=s.data[d];s.defaults.onPressEnter(u)}s.resetDropDown(),n.stopImmediatePropagation()})},setKeyUp:function(){var e=this;e.$input.on("keyup.lightAutocomplete",function(u){switch(u.keyCode){case o:case i:case t:case s:case n:case r:case c:return u.preventDefault(),!1;case a:return u.preventDefault(),e.moveUp(),!1;case l:return u.preventDefault(),e.moveDown(),!1;default:e.firstItem=1}e.search=e.$input.val().toLowerCase(),e.search.length>=e.defaults.minChars?(e.showTemplate(),"function"==typeof e.defaults.sourceData?e.defaults.sourceData(e.search,function(t){e.createDropDown(t)}):"string"==typeof e.defaults.sourceData&&(e.cache.length>0?e.createDropDown(e.cache):e.doAjax(e.defaults.sourceData))):e.cache=[]})},doAjax:function(t){var s=this;if(!1!==s.defaults.sendValue){var a=[];a[s.defaults.sendValue]=s.$input.val(),s.defaults.postData=e.extend({},s.defaults.postData,a)}e.ajax({url:t,dataType:"json",method:s.defaults.httpMethod,data:s.defaults.postData,success:function(e){var t=[];void 0!==s.defaults.onResponseAjax?s.defaults.onResponseAjax(e,t):e.forEach(function(e){t.push({label:e.label,value:e.value})}),s.cache=t,s.createDropDown(s.cache)},error:function(e,t,s){console.error(e)}})},createDropDown:function(t){var s=this,a=0;t.forEach(function(t,n){if(!1!==s.defaults.minSize&&a>=s.defaults.minSize)return!1;t.label.toLowerCase().indexOf(s.search)>-1&&(void 0===t.value&&(t.value=t.label),s.data[a]=t,s.last=++a,e(s.selectors.list,s.selectors.container,s.$input.parent()).append(s.createTempleteItem(t,a)))}),s.setClick(),s.setElementMouseover()},moveDown:function(){var t=this,s=parseInt(e(t.selectors.element+".selected").attr("item"));e(t.selectors.element).removeClass("selected"),s<t.last?e(t.selectors.element+"[item='"+(s+1)+"']").addClass("selected"):e(t.selectors.element+"[item='"+t.last+"']").addClass("selected"),s==t.firstItem+t.defaults.visibleElementInList-1&&s!=t.last&&(e(t.selectors.list,t.selectors.container).animate({scrollTop:"+="+t.defaults.heightOfElement},50),t.firstItem++)},moveUp:function(){var t=this,s=parseInt(e(t.selectors.element+".selected").attr("item"));e(t.selectors.element).removeClass("selected"),s>1?e(t.selectors.element+"[item='"+(s-1)+"']").addClass("selected"):e(t.selectors.element+"[item='1']").addClass("selected"),s==t.firstItem&&1!=s&&(e(t.selectors.list,t.selectors.container).animate({scrollTop:"-="+t.defaults.heightOfElement},50),t.firstItem--)},setFocus:function(){var t=this;e(document).on("click",function(s){var a=e(t.selectors.container);a.is(s.target)||t.$input.is(s.target)?t.$input.is(s.target)&&e(t.selectors.list,a).show():e(t.selectors.list,a).hide()})},setItem:function(e){void 0!==e&&this.$input.val(e.value)},setClick:function(){var t=this;e(t.selectors.element).on("click.lightAutocomplete tap.lightAutocomplete",function(){t.ifNotMatchData();var s=parseInt(e(this).attr("item"))-1,a=t.data[s];t.defaults.onClick(a),t.resetDropDown()})},resetDropDown:function(){var t=this;t.data=[],e(t.selectors.list,t.selectors.container).parent().remove(),t.insertTemplate()},insertTemplate:function(){e(this.createTemplateList()).insertAfter(this.id)},ifNotMatchData:function(){var t=this;""==t.$input.val()&&(t.data=[]),e(t.selectors.list+" li",t.selectors.container).length||(t.data=[])},showTemplate:function(){var t=this;e(t.selectors.list,t.selectors.container).parent().show(),e(t.selectors.list,t.selectors.container).html("")},createContainer:function(){this.$input.wrap("<div class='"+this.classes.container+"'></div>")},createTemplateList:function(){return"<div class='"+this.classes.list+"' style='display:none;'><ul style='overflow-y: scroll; max-height: "+this.defaults.maxHeight+"px;'></ul></div>"},createTempleteItem:function(e,t){var s="";return 1==t&&(s=" selected"),"<li><div item='"+t+"' class='"+this.classes.element+" "+s+"' style='max-height: "+this.defaults.heightOfElement+"px;'>"+e.label+"</div></li>"}},e.fn.lightAutocomplete=function(t,s){var a="lightAutocomplete";return arguments.length?this.each(function(){var n=e(this),l=n.data(a);"string"==typeof t?l&&"function"==typeof l[t]&&l[t](s):(l&&l.dispose&&l.dispose(),l=new u(this,t),n.data(a,l))}):this.first().data(a)}}(jQuery);